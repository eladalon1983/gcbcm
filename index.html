<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
    <title>getCurrentBrowsingContextMedia</title>
    <script class="remove" src="gcbcm.js" type="text/javascript"></script>
    <script src="https://www.w3.org/Tools/respec/respec-w3c" class="remove"></script>
  </head>
  <body>
    <section id="conformance"></section>
    <section id="abstract">
      <p>
        This document proposes a new dictionary member for
        <a data-cite="SCREEN-CAPTURE#dom-mediadevices-getdisplaymedia">getDisplayMedia</a>. This new
        member allows an application to specify a preference for capturing the tab from which
        <a data-cite="SCREEN-CAPTURE#dom-mediadevices-getdisplaymedia">getDisplayMedia</a> was
        called.
      </p>
    </section>
    <section id="introduction">
      <h2>Introduction</h2>
      <p>
        Currently,
        <a data-cite="SCREEN-CAPTURE#dom-mediadevices-getdisplaymedia">getDisplayMedia</a> does not
        allow the application to influence the user's selection of a capture source. This design
        decision is perennially debated. This document proposes a mechanism to allow one limited way
        of influencing the user's decision, and argues why this change is safe.
      </p>
      <section>
        <h3>Background</h3>
        <section>
          <h4>getDisplayMedia</h4>
          <p>
            Consider
            <a data-cite="SCREEN-CAPTURE#dom-mediadevices-getdisplaymedia">getDisplayMedia</a>. It
            allows applications to prompt the user for permission to capture a
            <a data-cite="SCREEN-CAPTURE#dfn-display-surface">display surface</a>.
            <a data-cite="SCREEN-CAPTURE#">The document</a> specifying
            <a data-cite="SCREEN-CAPTURE#dom-mediadevices-getdisplaymedia">getDisplayMedia</a>
            mandates that the application must not be allowed to influence the user's selection.
            That part of the standard is the source of recurring debates.
          </p>
          <ul>
            <li>
              On the one hand, the principle is sound - what a legitimate application can control, a
              malicious application can abuse.
            </li>
            <li>
              On the other hand, user agents may present
              <a data-cite="SCREEN-CAPTURE#dfn-display-surface">display surfaces</a>
              in any order and still be spec-compliant. Even if the riskiest option is presented
              first.
            </li>
          </ul>
          <p>
            The riskiest option is the current <a data-cite="SCREEN-CAPTURE#dfn-monitor">screen</a>.
            The current <a data-cite="SCREEN-CAPTURE#dfn-browser">tab</a>, which is very risky by
            virtue of being under the application's control, is visible on the current
            <a data-cite="SCREEN-CAPTURE#dfn-monitor">screen</a> when capture starts. This means a
            malicious application can embed and capture cross-origin content, which sould normally
            be opaque. A single frame is sufficient for such attacks.
          </p>
          <p>
            The current <a data-cite="SCREEN-CAPTURE#dfn-monitor">screen</a> is even riskier than
            the current <a data-cite="SCREEN-CAPTURE#dfn-browser">tab</a> on account of containing
            it as well as additional information.
          </p>
        </section>
        <section>
          <h4><dfn>getViewportMedia</dfn></h4>
          <p>
            An API called [=getViewportMedia=] is currently being standardized. Some opinions differ
            with respect to the required security measures.
          </p>
          <ul>
            <li>
              Some WebRTC WG members position is that
              <a data-cite="HTML#dom-crossoriginisolated">cross-origin isolation</a> is needed, as
              well as a yet unspecified <code>opt-in header</code>. This ensures that embedded
              documents and sub-resources opt-in to being capturable, addressing the concern of a
              malicious document reading cross-origin content using [=getViewportMedia=].
            </li>
            <li>
              Other WebRTC WG members believe that mandating
              <a data-cite="HTML#dom-crossoriginisolated">cross-origin isolation</a> and a new
              <code>opt-in header</code> will be adopted by the Web slowly. While
              [=getViewportMedia=] is valuable, something less restrictive is required in the
              meantime - an API that will present a
              <a data-cite="SCREEN-CAPTURE#dom-mediadevices-getdisplaymedia">getDisplayMedia</a
              >-like dialog to the user. This API will allow the user to choose any
              <a data-cite="SCREEN-CAPTURE#dfn-display-surface">display surface</a>, but it will
              present the current <a data-cite="SCREEN-CAPTURE#dfn-browser">tab</a> as the first
              option. (Note that this would comply with the standard's requirements for
              <a data-cite="SCREEN-CAPTURE#dom-mediadevices-getdisplaymedia">getDisplayMedia</a>.)
            </li>
          </ul>
        </section>
        <section>
          <h4>Conclusion</h4>
          <p>
            A variant of
            <a data-cite="SCREEN-CAPTURE#dom-mediadevices-getdisplaymedia">getDisplayMedia</a> that
            allows the user unconstrained
            <a data-cite="SCREEN-CAPTURE#dfn-display-surface">display surface</a> choice, but which
            orders <a data-cite="SCREEN-CAPTURE#dfn-display-surface">display surfaces</a> so that
            current <a data-cite="SCREEN-CAPTURE#dfn-monitor">screen</a> is NOT the first option,
            would be both spec-compliant as well as an improvement to user privacy and user
            security.
          </p>
          <p>
            If this variant presents the current
            <a data-cite="SCREEN-CAPTURE#dfn-browser">tab</a> as the first option, it will also be
            an alternative to [=getViewportMedia=] that can be called from a context lacking either
            <a data-cite="HTML#dom-crossoriginisolated">cross-origin isolation</a> or the opt-in
            header. (Recall that the current screen contains the current
            <a data-cite="SCREEN-CAPTURE#dfn-browser">tab</a>, and is therefore riskier.)
          </p>
          <p>We therefore propose {{MediaStreamConstraints/preferCurrentTab}}.</p>
        </section>
      </section>
    </section>
    <section id="prefer-current-tab">
      <h2>preferCurrentTab</h2>
      <pre class="idl">
        partial dictionary MediaStreamConstraints {
          boolean preferCurrentTab = false;
        };
      </pre>
      <dl data-link-for="MediaStreamConstraints" data-dfn-for="MediaStreamConstraints">
        <dt>
          <dfn>preferCurrentTab</dfn>
        </dt>
        <dd>
          <p>
            If <code>true</code>,
            <a data-cite="SCREEN-CAPTURE#dom-mediadevices-getdisplaymedia">getDisplayMedia</a>
            SHOULD present the current tab as the most prominent option. If <code>false</code>, no
            such requirement is made.
          </p>
        </dd>
      </dl>
    </section>
  </body>
</html>
